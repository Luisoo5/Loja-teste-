<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçï Pizzaria Bot - Central de Atendimento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f0f0f;
            height: 100vh;
            overflow: hidden;
            color: #fff;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            height: 100vh;
        }

        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: 60% 40%;
            }
        }

        /* √ÅREA DO WHATSAPP WEB */
        .whatsapp-area {
            position: relative;
            background: #111;
            border-right: 2px solid #e94560;
        }

        .whatsapp-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #075e54, #128c7e);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .whatsapp-header h2 {
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff4757;
            animation: pulse 2s infinite;
        }

        .status-dot.active {
            background: #2ed573;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #whatsappFrame {
            width: 100%;
            height: 100%;
            border: none;
            margin-top: 50px;
            height: calc(100% - 50px);
        }

        .connect-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0,0,0,0.9);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid #e94560;
        }

        .connect-overlay h3 {
            color: #e94560;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        /* PAINEL DE CONTROLE */
        .control-panel {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            background: rgba(233, 69, 96, 0.2);
            padding: 20px;
            border-bottom: 2px solid #e94560;
        }

        .panel-header h1 {
            font-size: 1.3em;
            color: #e94560;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tabs {
            display: flex;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            font-weight: 500;
        }

        .tab:hover {
            background: rgba(255,255,255,0.05);
        }

        .tab.active {
            background: rgba(233, 69, 96, 0.3);
            color: #e94560;
            border-bottom: 2px solid #e94560;
        }

        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* BOT√ïES */
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #e94560;
            color: white;
        }

        .btn-primary:hover {
            background: #ff6b6b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #0f3460;
            color: white;
        }

        .btn-secondary:hover {
            background: #1a4a7a;
        }

        .btn-success {
            background: #2ed573;
            color: #000;
        }

        .btn:disabled {
            background: #444;
            cursor: not-allowed;
            transform: none;
        }

        /* CHAT EM TEMPO REAL */
        .chat-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-item {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .chat-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .chat-item.active {
            border-left-color: #e94560;
            background: rgba(233, 69, 96, 0.1);
        }

        .chat-item.bot-responded {
            border-left-color: #2ed573;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .chat-name {
            font-weight: bold;
            color: #fff;
        }

        .chat-time {
            font-size: 0.75em;
            color: #888;
        }

        .chat-preview {
            font-size: 0.85em;
            color: #aaa;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-badge {
            background: #e94560;
            color: white;
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }

        /* LOGS */
        .log-container {
            background: #0a0a0a;
            border-radius: 8px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            border: 1px solid #333;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 6px;
            border-radius: 4px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .log-in { color: #3498db; border-left: 2px solid #3498db; padding-left: 8px; }
        .log-out { color: #2ed573; border-left: 2px solid #2ed573; padding-left: 8px; }
        .log-system { color: #f1c40f; border-left: 2px solid #f1c40f; padding-left: 8px; }
        .log-error { color: #ff4757; border-left: 2px solid #ff4757; padding-left: 8px; }

        .timestamp {
            color: #666;
            font-size: 0.9em;
        }

        /* CONFIGURA√á√ïES */
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .toggle {
            width: 50px;
            height: 26px;
            background: #333;
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle.active {
            background: #e94560;
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }

        .toggle.active::after {
            left: 26px;
        }

        /* CARD√ÅPIO */
        .menu-section {
            margin-bottom: 20px;
        }

        .menu-section h3 {
            color: #e94560;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: rgba(255,255,255,0.03);
            margin-bottom: 5px;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .menu-price {
            color: #2ed573;
            font-weight: bold;
        }

        /* ESTAT√çSTICAS */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #e94560;
        }

        .stat-label {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }

        /* INJECTOR DE C√ìDIGO */
        .code-injector {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .code-display {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 0.75em;
            padding: 10px;
            border-radius: 4px;
            max-height: 150px;
            overflow-y: auto;
            margin: 10px 0;
            white-space: pre-wrap;
        }

        .warning-box {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            color: #ffc107;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85em;
            margin: 10px 0;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: #e94560;
            border-radius: 3px;
        }

        /* ANIMA√á√ïES */
        .typing-indicator {
            display: inline-flex;
            gap: 3px;
            padding: 4px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-left: 5px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #e94560;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- √ÅREA DO WHATSAPP WEB -->
        <div class="whatsapp-area">
            <div class="whatsapp-header">
                <h2>
                    <span>üí¨</span>
                    <span>WhatsApp Web - Pizzaria</span>
                </h2>
                <div class="status-badge">
                    <span class="status-dot" id="botStatusDot"></span>
                    <span id="botStatusText">Bot Offline</span>
                </div>
            </div>

            <iframe id="whatsappFrame" src="about:blank"></iframe>

            <div class="connect-overlay" id="connectOverlay">
                <h3>üçï Bem-vindo √† Central</h3>
                <p style="margin-bottom: 20px; color: #aaa;">Conecte seu WhatsApp para come√ßar</p>
                <button class="btn btn-primary" onclick="loadWhatsAppWeb()">
                    üöÄ Abrir WhatsApp Web
                </button>
                <p style="margin-top: 15px; font-size: 0.85em; color: #666;">
                    ou acesse web.whatsapp.com
                </p>
            </div>
        </div>

        <!-- PAINEL DE CONTROLE -->
        <div class="control-panel">
            <div class="panel-header">
                <h1>
                    <span>ü§ñ</span>
                    <span>Painel de Controle</span>
                </h1>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('chats')">üí¨ Chats</div>
                <div class="tab" onclick="switchTab('logs')">üìä Logs</div>
                <div class="tab" onclick="switchTab('config')">‚öôÔ∏è Config</div>
            </div>

            <!-- ABA CHATS -->
            <div class="tab-content active" id="tab-chats">
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="statTotal">0</div>
                        <div class="stat-label">Total Chats</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="statBot">0</div>
                        <div class="stat-label">Bot Atuou</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="statPending">0</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="statToday">0</div>
                        <div class="stat-label">Hoje</div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="injectBotCode()" id="btnInject">
                    ‚ö° Ativar Bot no WhatsApp
                </button>

                <div class="chat-list" id="chatList">
                    <div style="text-align: center; color: #666; padding: 40px;">
                        Nenhum chat ativo<br>
                        <small>Aguardando conex√£o...</small>
                    </div>
                </div>
            </div>

            <!-- ABA LOGS -->
            <div class="tab-content" id="tab-logs">
                <div class="log-container" id="logContainer">
                    <div class="log-entry log-system">
                        <span class="timestamp">[SISTEMA]</span> Central de atendimento iniciada
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="clearLogs()">
                    üóëÔ∏è Limpar Logs
                </button>
            </div>

            <!-- ABA CONFIG -->
            <div class="tab-content" id="tab-config">
                <div class="menu-section">
                    <h3>üçï Card√°pio R√°pido</h3>
                    <div class="menu-item">
                        <span>üßÄ Mussarela</span>
                        <span class="menu-price">R$ 35</span>
                    </div>
                    <div class="menu-item">
                        <span>üçñ Calabresa</span>
                        <span class="menu-price">R$ 38</span>
                    </div>
                    <div class="menu-item">
                        <span>üçó Frango</span>
                        <span class="menu-price">R$ 42</span>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px; color: #e94560;">Configura√ß√µes do Bot</h3>
                
                <div class="config-item">
                    <span>Resposta autom√°tica</span>
                    <div class="toggle active" onclick="toggleConfig(this, 'autoReply')"></div>
                </div>
                <div class="config-item">
                    <span>Mostrar "digitando..."</span>
                    <div class="toggle active" onclick="toggleConfig(this, 'typing')"></div>
                </div>
                <div class="config-item">
                    <span>Somente contatos salvos</span>
                    <div class="toggle" onclick="toggleConfig(this, 'onlyContacts')"></div>
                </div>
                <div class="config-item">
                    <span>Ignorar grupos</span>
                    <div class="toggle active" onclick="toggleConfig(this, 'ignoreGroups')"></div>
                </div>
                <div class="config-item">
                    <span>Delay resposta (1-3s)</span>
                    <div class="toggle active" onclick="toggleConfig(this, 'delay')"></div>
                </div>

                <div class="warning-box" style="margin-top: 20px;">
                    ‚ö†Ô∏è O bot funciona apenas enquanto esta aba estiver aberta
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ïES
        let config = {
            autoReply: true,
            typing: true,
            onlyContacts: false,
            ignoreGroups: true,
            delay: true
        };

        let chats = {};
        let botActive = false;
        let chatCounter = { total: 0, bot: 0, pending: 0, today: 0 };

        // LOGGER
        function addLog(message, type = 'system') {
            const container = document.getElementById('logContainer');
            const time = new Date().toLocaleTimeString('pt-BR');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `<span class="timestamp">[${time}]</span> ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('Logs limpos', 'system');
        }

        // CARREGAR WHATSAPP WEB
        function loadWhatsAppWeb() {
            document.getElementById('whatsappFrame').src = 'https://web.whatsapp.com';
            document.getElementById('connectOverlay').style.display = 'none';
            addLog('Carregando WhatsApp Web...', 'system');
            
            // Verifica se carregou
            setTimeout(() => {
                addLog('WhatsApp Web carregado. Fa√ßa login se necess√°rio.', 'system');
                addLog('Clique em "Ativar Bot" ap√≥s fazer login.', 'system');
            }, 3000);
        }

        // INJETAR C√ìDIGO DO BOT
        function injectBotCode() {
            const frame = document.getElementById('whatsappFrame');
            
            if (frame.src === 'about:blank') {
                alert('Primeiro abra o WhatsApp Web!');
                return;
            }

            addLog('Preparando inje√ß√£o do bot...', 'system');
            
            // Como n√£o podemos acessar o iframe diretamente por seguran√ßa,
            // vamos abrir em nova aba com o c√≥digo pronto
            const botCode = generateBotCode();
            const newWindow = window.open('https://web.whatsapp.com', '_blank');
            
            // Armazena o c√≥digo para c√≥pia
            localStorage.setItem('pizzariaBotCode', botCode);
            
            setTimeout(() => {
                alert('üçï C√ìDIGO DO BOT COPIADO!\n\n1. Na nova aba do WhatsApp Web, aperte F12\n2. V√° no Console\n3. Cole o c√≥digo (Ctrl+V)\n4. Aperte Enter\n\nO bot come√ßar√° a funcionar automaticamente!');
                copyToClipboard(botCode);
                addLog('C√≥digo copiado! Cole no console do WhatsApp Web.', 'system');
                
                // Simula ativa√ß√£o
                setTimeout(() => {
                    activateBotMode();
                }, 5000);
            }, 1000);
        }

        function generateBotCode() {
            return `
// üçï PIZZARIA BOT - Cole no Console do WhatsApp Web e aperte Enter
(function() {
    if (window.pizzariaBotActive) {
        console.log('Bot j√° est√° ativo!');
        return;
    }
    window.pizzariaBotActive = true;
    
    console.log('üçï Pizzaria Bot iniciado!');
    console.log('Monitorando mensagens...');
    
    const CONFIG = {
        autoReply: ${config.autoReply},
        typing: ${config.typing},
        onlyContacts: ${config.onlyContacts},
        ignoreGroups: ${config.ignoreGroups}
    };
    
    // Notifica painel principal
    window.parent.postMessage({type: 'BOT_ACTIVATED'}, '*');
    
    // Fun√ß√£o para enviar mensagem
    async function sendMessage(chat, text) {
        try {
            if (CONFIG.typing) {
                chat.markComposing();
                await new Promise(r => setTimeout(r, 1000 + Math.random() * 2000));
            }
            await chat.sendMessage(text);
            
            // Notifica painel
            window.parent.postMessage({
                type: 'MESSAGE_SENT',
                chat: chat.name || chat.id.user,
                text: text
            }, '*');
            
            return true;
        } catch(e) {
            console.error('Erro:', e);
            return false;
        }
    }
    
    // Observer de mensagens
    const checkMessages = setInterval(() => {
        if (!window.Store || !window.Store.Msg) return;
        
        window.Store.Msg.models.forEach(async (msg) => {
            if (!msg.isNewMsg || msg.fromMe) return;
            
            const chat = await msg.getChat();
            const contact = await msg.getContact();
            
            if (CONFIG.ignoreGroups && chat.isGroup) return;
            if (CONFIG.onlyContacts && !contact.isMyContact) return;
            
            const text = msg.body.toLowerCase();
            let resposta = '';
            
            // L√ìGICA DA PIZZARIA
            if (text.match(/oi|ol√°|ola|bom dia|boa tarde|boa noite/)) {
                resposta = \`üçï *Bem-vindo √† Pizzaria!*\\n\\nEscolha uma op√ß√£o:\\n\\n1Ô∏è‚É£ Card√°pio\\n2Ô∏è‚É£ Bebidas\\n3Ô∏è‚É£ Fazer pedido\\n4Ô∏è‚É£ Promo√ß√µes\\n5Ô∏è‚É£ Falar com atendente\`;
            }
            else if (text === '1' || text.includes('card√°pio')) {
                resposta = 'üìã *Pizzas:*\\nüßÄ Mussarela - R$35\\nüçñ Calabresa - R$38\\nüçó Frango - R$42\\nü•ì Portuguesa - R$40\\nüç´ Chocolate - R$45';
            }
            else if (text === '2' || text.includes('bebida')) {
                resposta = 'ü•§ *Bebidas:*\\nCoca 2L - R$12\\nGuaran√° 2L - R$10\\nSuco Natural - R$8';
            }
            else if (text === '3' || text.includes('pedido')) {
                resposta = 'üõí *Novo Pedido*\\n\\nMe diga:\\n1. Qual pizza?\\n2. Tamanho (P/M/G)\\n3. Endere√ßo\\n4. Pagamento\\n\\n_Ex: "Quero Calabresa G, Rua das Flores 123, dinheiro"_';
            }
            else if (text === '4' || text.includes('promo√ß√£o')) {
                resposta = 'üéâ *PROMO√á√ïES:*\\n\\n‚ú® Combo Fam√≠lia: 2 Pizzas G + Refri = R$89,90\\n‚úÖ Taxa GR√ÅTIS acima de R$60';
            }
            else if (text === '5' || text.includes('atendente')) {
                resposta = 'üë®‚Äçüíº Encaminhando para atendente humano... Aguarde!';
            }
            else if (text.includes('obrigado') || text.includes('valeu')) {
                resposta = 'üòä Por nada! Bom apetite! üçï';
            }
            else {
                resposta = 'N√£o entendi... Digite *"oi"* para ver o menu! üçï';
            }
            
            if (resposta && CONFIG.autoReply) {
                await sendMessage(chat, resposta);
                msg.isNewMsg = false; // Marca como processada
            }
        });
    }, 1000);
    
    // Exp√µe controle
    window.pizzariaBot = {
        stop: () => {
            clearInterval(checkMessages);
            window.pizzariaBotActive = false;
            console.log('Bot parado');
        },
        status: () => console.log('Bot ativo:', window.pizzariaBotActive)
    };
    
    console.log('‚úÖ Bot rodando! Aguardando mensagens...');
})();`;
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        // ATIVAR MODO BOT
        function activateBotMode() {
            botActive = true;
            document.getElementById('botStatusDot').classList.add('active');
            document.getElementById('botStatusText').textContent = 'Bot Online';
            document.getElementById('btnInject').textContent = '‚úÖ Bot Ativo';
            document.getElementById('btnInject').disabled = true;
            
            addLog('ü§ñ Bot ativado com sucesso!', 'system');
            
            // Simula recebimento de mensagens para demonstra√ß√£o
            simulateIncomingMessages();
        }

        // SIMULAR MENSAGENS (DEMO)
        function simulateIncomingMessages() {
            const demoChats = [
                { name: 'Jo√£o Silva', msg: 'Oi, queria fazer um pedido', time: '14:32' },
                { name: 'Maria Oliveira', msg: 'Qual o pre√ßo da Calabresa?', time: '14:30' },
                { name: 'Carlos Santos', msg: 'Voc√™s entregam no centro?', time: '14:28' }
            ];
            
            let index = 0;
            const interval = setInterval(() => {
                if (index >= demoChats.length) {
                    clearInterval(interval);
                    return;
                }
                
                const chat = demoChats[index];
                addChat(chat.name, chat.msg, chat.time);
                
                // Simula resposta do bot ap√≥s 2 segundos
                setTimeout(() => {
                    respondToChat(chat.name);
                }, 2000);
                
                index++;
            }, 4000);
        }

        function addChat(name, message, time) {
            const list = document.getElementById('chatList');
            
            // Remove mensagem vazia inicial
            if (list.children.length === 1 && list.children[0].innerHTML.includes('Nenhum chat')) {
                list.innerHTML = '';
            }
            
            const chatId = 'chat_' + Date.now();
            const div = document.createElement('div');
            div.className = 'chat-item';
            div.id = chatId;
            div.innerHTML = \`
                <div class="chat-header">
                    <span class="chat-name">\${name} <span class="chat-badge">novo</span></span>
                    <span class="chat-time">\${time}</span>
                </div>
                <div class="chat-preview">üë§: \${message}</div>
                <div class="typing-indicator" id="typing_\${chatId}" style="display:none;">
                    <span>Bot est√° digitando</span>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            \`;
            
            div.onclick = () => selectChat(chatId);
            list.insertBefore(div, list.firstChild);
            
            chats[chatId] = { name, message, responded: false };
            updateStats();
            
            addLog(\`üì© Nova mensagem de \${name}: "\${message}"\`, 'in');
        }

        function respondToChat(name) {
            const chatId = Object.keys(chats).find(id => chats[id].name === name);
            if (!chatId || chats[chatId].responded) return;
            
            const chatEl = document.getElementById(chatId);
            const typingEl = document.getElementById('typing_' + chatId);
            
            // Mostra "digitando..."
            typingEl.style.display = 'inline-flex';
            addLog(\`ü§ñ Bot est√° digitando para \${name}...\`, 'system');
            
            setTimeout(() => {
                typingEl.style.display = 'none';
                chatEl.classList.add('bot-responded');
                chatEl.querySelector('.chat-badge').textContent = 'respondido';
                chatEl.querySelector('.chat-badge').style.background = '#2ed573';
                
                const responses = [
                    'üçï Bem-vindo! Escolha: 1-Card√°pio 2-Bebidas 3-Pedido 4-Promo√ß√µes 5-Atendente',
                    'üìã Card√°pio: Mussarela R$35, Calabresa R$38, Frango R$42',
                    'üéâ Promo√ß√£o: 2 Pizzas G + Refri = R$89,90!'
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                const preview = chatEl.querySelector('.chat-preview');
                preview.innerHTML = \`ü§ñ: \${response}\`;
                preview.style.color = '#2ed573';
                
                chats[chatId].responded = true;
                updateStats();
                
                addLog(\`‚úÖ Resposta enviada para \${name}: "\${response.substring(0, 30)}..."\`, 'out');
            }, 2000);
        }

        function selectChat(chatId) {
            document.querySelectorAll('.chat-item').forEach(el => el.classList.remove('active'));
            document.getElementById(chatId).classList.add('active');
            addLog(\`Chat selecionado: \${chats[chatId].name}\`, 'system');
        }

        function updateStats() {
            const total = Object.keys(chats).length;
            const bot = Object.values(chats).filter(c => c.responded).length;
            const pending = total - bot;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statBot').textContent = bot;
            document.getElementById('statPending').textContent = pending;
            document.getElementById('statToday').textContent = total;
        }

        // TABS
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        // CONFIG TOGGLES
        function toggleConfig(element, key) {
            element.classList.toggle('active');
            config[key] = element.classList.contains('active');
            addLog(\`Config "\${key}" alterada para: \${config[key]}\`, 'system');
        }

        // LISTEN PARA MENSAGENS DO IFRAME (se permitido)
        window.addEventListener('message', (e) => {
            if (e.data.type === 'BOT_ACTIVATED') {
                activateBotMode();
            }
            else if (e.data.type === 'MESSAGE_SENT') {
                addLog(\`Bot respondeu \${e.data.chat}: \${e.data.text.substring(0, 40)}...\`, 'out');
            }
        });

        // INICIALIZA√á√ÉO
        addLog('üçï Central da Pizzaria iniciada', 'system');
        addLog('Clique em "Abrir WhatsApp Web" para come√ßar', 'system');
    </script>
</body>
</html>
