<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçï Pizzaria Bot - WhatsApp Web</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid #e94560;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            color: #e94560;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            color: #a0a0a0;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .card h2 {
            color: #e94560;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3em;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .status.offline {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        .status.online {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 10px;
        }

        button:hover {
            background: #ff6b6b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 69, 96, 0.3);
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #0f3460;
        }

        button.secondary:hover {
            background: #1a4a7a;
        }

        .code-box {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #0f0;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            position: relative;
        }

        .code-box::before {
            content: "C√ìDIGO PARA COLAR NO CONSOLE";
            position: absolute;
            top: -10px;
            left: 10px;
            background: #e94560;
            padding: 2px 10px;
            font-size: 0.7em;
            border-radius: 4px;
            color: white;
        }

        .menu-preview {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .price {
            color: #e94560;
            font-weight: bold;
        }

        .instructions {
            background: rgba(233, 69, 96, 0.1);
            border-left: 3px solid #e94560;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        .instructions h3 {
            color: #e94560;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
            line-height: 1.8;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .log-container {
            background: #0a0a0a;
            border-radius: 8px;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-top: 15px;
            border: 1px solid #333;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 4px;
        }

        .log-info { color: #3498db; }
        .log-success { color: #2ed573; }
        .log-error { color: #ff4757; }
        .log-warning { color: #f1c40f; }

        .timestamp {
            color: #666;
            font-size: 0.9em;
        }

        .config-section {
            margin-top: 15px;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .toggle {
            width: 50px;
            height: 26px;
            background: #333;
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle.active {
            background: #e94560;
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }

        .toggle.active::after {
            left: 26px;
        }

        .highlight {
            background: rgba(233, 69, 96, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            color: #e94560;
            font-weight: bold;
        }

        .warning-box {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            color: #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }

        .copy-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #333;
            border: 1px solid #555;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .copy-btn:hover {
            background: #e94560;
            border-color: #e94560;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçï Pizzaria Bot</h1>
            <p class="subtitle">Atendimento autom√°tico para WhatsApp Web</p>
        </header>

        <div class="main-grid">
            <!-- Painel de Controle -->
            <div class="card">
                <h2>‚ö° Controle do Bot</h2>
                
                <div id="statusIndicator" class="status offline">
                    <span class="status-dot"></span>
                    <span id="statusText">Aguardando...</span>
                </div>

                <div class="instructions">
                    <h3>üöÄ Como ativar:</h3>
                    <ol>
                        <li>Abra <span class="highlight">web.whatsapp.com</span> em outra aba</li>
                        <li>Fa√ßa login com seu celular</li>
                        <li>Clique no bot√£o abaixo para gerar o c√≥digo</li>
                        <li>Copie o c√≥digo e cole no <strong>Console</strong> do WhatsApp Web (F12)</li>
                        <li>Pronto! O bot responder√° automaticamente</li>
                    </ol>
                </div>

                <button onclick="generateBotCode()" id="btnGenerate">
                    üìù Gerar C√≥digo do Bot
                </button>
                
                <button onclick="openWhatsAppWeb()" class="secondary">
                    üåê Abrir WhatsApp Web
                </button>

                <div class="warning-box">
                    ‚ö†Ô∏è Mantenha esta aba aberta para ver os logs
                </div>
            </div>

            <!-- Configura√ß√µes da Pizzaria -->
            <div class="card">
                <h2>üçï Card√°pio & Config</h2>
                
                <div class="menu-preview">
                    <h3 style="margin-bottom: 10px; color: #e94560;">Pizzas Tradicionais</h3>
                    <div class="menu-item">
                        <span>üßÄ Mussarela</span>
                        <span class="price">R$ 35,00</span>
                    </div>
                    <div class="menu-item">
                        <span>üçñ Calabresa</span>
                        <span class="price">R$ 38,00</span>
                    </div>
                    <div class="menu-item">
                        <span>üçó Frango c/ Catupiry</span>
                        <span class="price">R$ 42,00</span>
                    </div>
                    <div class="menu-item">
                        <span>ü•ì Portuguesa</span>
                        <span class="price">R$ 40,00</span>
                    </div>
                    <div class="menu-item">
                        <span>üç´ Chocolate</span>
                        <span class="price">R$ 45,00</span>
                    </div>
                </div>

                <div class="config-section">
                    <div class="config-item">
                        <span>Resposta autom√°tica</span>
                        <div class="toggle active" onclick="toggleConfig(this, 'autoReply')"></div>
                    </div>
                    <div class="config-item">
                        <span>Modo "Digitando..."</span>
                        <div class="toggle active" onclick="toggleConfig(this, 'typing')"></div>
                    </div>
                    <div class="config-item">
                        <span>Apenas contatos salvos</span>
                        <div class="toggle" onclick="toggleConfig(this, 'onlyContacts')"></div>
                    </div>
                    <div class="config-item">
                        <span>Ignorar grupos</span>
                        <div class="toggle active" onclick="toggleConfig(this, 'ignoreGroups')"></div>
                    </div>
                </div>
            </div>

            <!-- C√≥digo Gerado -->
            <div class="card" style="grid-column: 1 / -1;">
                <h2>üíª C√≥digo para WhatsApp Web</h2>
                <p style="margin-bottom: 10px; color: #aaa;">
                    Copie este c√≥digo e cole no console do WhatsApp Web (pressione F12 ‚Üí Console)
                </p>
                
                <div class="code-box" id="codeBox">
                    <button class="copy-btn" onclick="copyCode()">üìã Copiar</button>
                    <code id="botCode">// Clique em "Gerar C√≥digo do Bot" para criar o c√≥digo...</code>
                </div>

                <button onclick="copyCode()" style="width: auto; display: inline-block; margin-right: 10px;">
                    üìã Copiar C√≥digo
                </button>
                <button onclick="clearCode()" class="secondary" style="width: auto; display: inline-block;">
                    üóëÔ∏è Limpar
                </button>
            </div>

            <!-- Logs -->
            <div class="card" style="grid-column: 1 / -1;">
                <h2>üìä Logs de Atendimento</h2>
                <div class="log-container" id="logContainer">
                    <div class="log-entry log-info">
                        <span class="timestamp">[Sistema]</span> Aguardando ativa√ß√£o do bot...
                    </div>
                </div>
                <button onclick="clearLogs()" style="margin-top: 10px; width: auto;">
                    üóëÔ∏è Limpar Logs
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes
        let config = {
            autoReply: true,
            typing: true,
            onlyContacts: false,
            ignoreGroups: true
        };

        // Card√°pio da pizzaria
        const menu = {
            pizzas: [
                { nome: 'Mussarela', preco: 35, desc: 'Molho de tomate, mussarela e or√©gano' },
                { nome: 'Calabresa', preco: 38, desc: 'Molho, mussarela, calabresa e cebola' },
                { nome: 'Frango c/ Catupiry', preco: 42, desc: 'Molho, frango desfiado e catupiry' },
                { nome: 'Portuguesa', preco: 40, desc: 'Presunto, ovos, cebola, azeitona e ervilha' },
                { nome: 'Quatro Queijos', preco: 45, desc: 'Mussarela, provolone, parmes√£o e catupiry' },
                { nome: 'Chocolate', preco: 45, desc: 'Chocolate ao leite com granulado' }
            ],
            bebidas: [
                { nome: 'Coca-Cola 2L', preco: 12 },
                { nome: 'Guaran√° 2L', preco: 10 },
                { nome: 'Suco Natural', preco: 8 }
            ]
        };

        // Logger
        function addLog(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const time = new Date().toLocaleTimeString('pt-BR');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `<span class="timestamp">[${time}]</span> ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('Logs limpos', 'info');
        }

        // Toggle config
        function toggleConfig(element, key) {
            element.classList.toggle('active');
            config[key] = element.classList.contains('active');
            addLog(`Configura√ß√£o "${key}" alterada para: ${config[key]}`, 'info');
        }

        // Abrir WhatsApp Web
        function openWhatsAppWeb() {
            window.open('https://web.whatsapp.com', '_blank');
            addLog('Abrindo WhatsApp Web...', 'info');
        }

        // Gerar c√≥digo do bot
        function generateBotCode() {
            const code = `
// üçï PIZZARIA BOT - Cole todo este c√≥digo no Console do WhatsApp Web (F12)
// E pressione Enter. O bot come√ßar√° a funcionar imediatamente!

(function() {
    'use strict';
    
    console.log('üçï Pizzaria Bot iniciando...');
    
    // CONFIGURA√á√ïES
    const CONFIG = {
        autoReply: ${config.autoReply},
        typing: ${config.typing},
        onlyContacts: ${config.onlyContacts},
        ignoreGroups: ${config.ignoreGroups},
        delayMin: 1000,
        delayMax: 3000
    };
    
    // CARD√ÅPIO
    const MENU = {
        pizzas: [
            { nome: 'Mussarela', preco: 35, emoji: 'üßÄ' },
            { nome: 'Calabresa', preco: 38, emoji: 'üçñ' },
            { nome: 'Frango c/ Catupiry', preco: 42, emoji: 'üçó' },
            { nome: 'Portuguesa', preco: 40, emoji: 'ü•ì' },
            { nome: 'Quatro Queijos', preco: 45, emoji: 'üßÄ' },
            { nome: 'Chocolate', preco: 45, emoji: 'üç´' }
        ],
        bebidas: [
            { nome: 'Coca-Cola 2L', preco: 12, emoji: 'ü•§' },
            { nome: 'Guaran√° 2L', preco: 10, emoji: 'ü•§' },
            { nome: 'Suco Natural', preco: 8, emoji: 'üßÉ' }
        ]
    };
    
    // ESTADO
    let atendimentos = {};
    let isRunning = true;
    
    // FUN√á√ÉO: Enviar mensagem
    async function sendMessage(chatId, text) {
        try {
            // Simula "digitando..."
            if (CONFIG.typing) {
                const chat = await window.Store.Chat.find(chatId);
                chat.markComposing();
                await sleep(random(CONFIG.delayMin, CONFIG.delayMax));
            }
            
            // Envia a mensagem
            const msg = await window.Store.Chat.find(chatId);
            await msg.sendMessage(text);
            
            console.log('‚úÖ Enviado:', text.substring(0, 50) + '...');
            return true;
        } catch (err) {
            console.error('‚ùå Erro ao enviar:', err);
            return false;
        }
    }
    
    // FUN√á√ÉO: Processar mensagem recebida
    async function processMessage(message) {
        if (!isRunning) return;
        if (message.fromMe) return; // Ignora mensagens enviadas por mim
        
        const chatId = message.from;
        const text = message.body.toLowerCase();
        const contact = await message.getContact();
        const chat = await message.getChat();
        
        // Ignora grupos se configurado
        if (CONFIG.ignoreGroups && chat.isGroup) return;
        
        // Verifica se √© contato salvo
        if (CONFIG.onlyContacts && !contact.isMyContact) return;
        
        // Inicializa atendimento
        if (!atendimentos[chatId]) {
            atendimentos[chatId] = { etapa: 'inicio', pedido: [] };
        }
        
        const atendimento = atendimentos[chatId];
        let resposta = '';
        
        // L√ìGICA DO CARD√ÅPIO/ATENDIMENTO
        if (text.includes('oi') || text.includes('ol√°') || text.includes('ola') || text.includes('bom dia') || text.includes('boa tarde') || text.includes('boa noite')) {
            resposta = \`üçï *Bem-vindo √† Pizzaria!*\n\nOl√°! Sou o assistente virtual. Como posso ajudar?\n\n*Digite o n√∫mero da op√ß√£o desejada:*\n\n1Ô∏è‚É£ - Ver card√°pio de pizzas\n2Ô∏è‚É£ - Ver bebidas\n3Ô∏è‚É£ - Fazer um pedido\n4Ô∏è‚É£ - Ver promo√ß√µes\n5Ô∏è‚É£ - Falar com atendente\`;
            atendimento.etapa = 'menu';
        }
        else if (text === '1' || text.includes('card√°pio') || text.includes('pizza')) {
            resposta = 'üìã *Card√°pio de Pizzas*\\n\\n';
            MENU.pizzas.forEach((pizza, index) => {
                resposta += \`\${pizza.emoji} *\${index + 1}. \${pizza.nome}* - R$ \${pizza.preco},00\\n\`;
            });
            resposta += '\\n_Digite o n√∫mero da pizza para adicionar ao pedido_ üõí';
            atendimento.etapa = 'escolhendo_pizza';
        }
        else if (text === '2' || text.includes('bebida')) {
            resposta = 'ü•§ *Bebidas*\\n\\n';
            MENU.bebidas.forEach((bebida, index) => {
                resposta += \`\${bebida.emoji} *\${index + 1}. \${bebida.nome}* - R$ \${bebida.preco},00\\n\`;
            });
            resposta += '\\n_Digite o n√∫mero da bebida para adicionar_ üõí';
            atendimento.etapa = 'escolhendo_bebida';
        }
        else if (text === '3' || text.includes('pedido')) {
            resposta = 'üõí *Novo Pedido*\\n\\nPara fazer seu pedido, me diga:\\n1. Qual pizza (nome ou n√∫mero)\\n2. Tamanho: P, M ou G\\n3. Endere√ßo de entrega\\n4. Forma de pagamento\\n\\n_Exemplo: "Quero uma Calabresa grande, entrega na Rua das Flores 123, pagamento em dinheiro"_';
            atendimento.etapa = 'pedido';
        }
        else if (text === '4' || text.includes('promo√ß√£o') || text.includes('promocao')) {
            resposta = 'üéâ *PROMO√á√ïES DO DIA* üéâ\\n\\n‚ú® *Combo Fam√≠lia:*\\n2 Pizzas Grandes + 1 Refri 2L = *R$ 89,90*\\n\\n‚ú® *Pizza em Dobro:*\\nNa compra de 1 pizza G, a segunda sai *50% OFF*\\n\\n‚ú® *Taxa FREE:*\\nPedidos acima de R$ 60 = *Entrega Gr√°tis* üöö\\n\\n_Digite "quero promo√ß√£o" para aproveitar!_';
        }
        else if (text === '5' || text.includes('atendente') || text.includes('humano') || text.includes('pessoa')) {
            resposta = 'üë®‚Äçüíº *Encaminhando para atendente...*\\n\\nAguarde um momento, por favor. Um de nossos atendentes ir√° te atender em breve.\\n\\n‚è∞ _Hor√°rio de atendimento: 18h √†s 23h_';
            atendimento.etapa = 'esperando_atendente';
        }
        else if (text.includes('obrigado') || text.includes('valeu') || text.includes('agrade√ßo')) {
            resposta = 'üòä *Por nada!* Ficamos felizes em atender voc√™!\\n\\nSe precisar de mais alguma coisa, √© s√≥ chamar. Bom apetite! üçï';
        }
        else if (text.includes('tchau') || text.includes('at√© logo') || text.includes('ate logo')) {
            resposta = 'üëã *At√© logo!* Obrigado por escolher nossa pizzaria! Volte sempre! üçï';
            delete atendimentos[chatId];
        }
        else {
            // Resposta padr√£o para mensagens n√£o reconhecidas
            resposta = 'ü§î N√£o entendi bem...\\n\\nDigite *"oi"* para ver as op√ß√µes ou escolha:\\n\\n1Ô∏è‚É£ Card√°pio\\n2Ô∏è‚É£ Bebidas\\n3Ô∏è‚É£ Fazer pedido\\n4Ô∏è‚É£ Promo√ß√µes\\n5Ô∏è‚É£ Falar com atendente';
        }
        
        // Envia resposta
        if (resposta && CONFIG.autoReply) {
            await sendMessage(chatId, resposta);
        }
    }
    
    // FUN√á√ÉO: Observar novas mensagens
    function startObserver() {
        // Verifica se o Store do WhatsApp est√° dispon√≠vel
        if (typeof window.Store === 'undefined') {
            console.error('‚ùå Store n√£o encontrada. Certifique-se de estar no WhatsApp Web.');
            return false;
        }
        
        console.log('üëÄ Observando mensagens...');
        
        // Hook no processamento de mensagens
        window.Store.Msg.on('add', async (msg) => {
            if (msg.isNewMsg && !msg.fromMe) {
                console.log('üì© Nova mensagem:', msg.body);
                await processMessage(msg);
            }
        });
        
        return true;
    }
    
    // UTILIT√ÅRIOS
    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    function random(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    
    // INICIALIZA√á√ÉO
    if (startObserver()) {
        console.log('‚úÖ Pizzaria Bot ativo!');
        console.log('üìã Comandos dispon√≠veis:');
        console.log('   window.pizzariaBot.stop() - Para o bot');
        console.log('   window.pizzariaBot.start() - Inicia o bot');
        console.log('   window.pizzariaBot.status - Ver status');
        
        // Exp√µe controle global
        window.pizzariaBot = {
            stop: () => { isRunning = false; console.log('üõë Bot parado'); },
            start: () => { isRunning = true; console.log('‚ñ∂Ô∏è Bot iniciado'); },
            status: () => console.log('Status:', isRunning ? 'Rodando' : 'Parado', '| Atendimentos:', Object.keys(atendimentos).length),
            config: CONFIG
        };
    } else {
        console.error('‚ùå Falha ao iniciar. Recarregue a p√°gina e tente novamente.');
    }
    
})();`;

            document.getElementById('botCode').textContent = code;
            addLog('C√≥digo gerado com sucesso! Copie e cole no WhatsApp Web.', 'success');
            
            // Atualiza status
            document.getElementById('statusIndicator').className = 'status online';
            document.getElementById('statusText').textContent = 'C√≥digo pronto!';
        }

        // Copiar c√≥digo
        function copyCode() {
            const code = document.getElementById('botCode').textContent;
            if (code.includes('Clique em')) {
                alert('Gere o c√≥digo primeiro!');
                return;
            }
            
            navigator.clipboard.writeText(code).then(() => {
                addLog('C√≥digo copiado para √°rea de transfer√™ncia!', 'success');
                alert('‚úÖ C√≥digo copiado!\n\nAgora:\n1. Abra web.whatsapp.com\n2. Aperte F12\n3. Cole no Console\n4. Aperte Enter');
            });
        }

        function clearCode() {
            document.getElementById('botCode').textContent = '// Clique em "Gerar C√≥digo do Bot" para criar o c√≥digo...';
            document.getElementById('statusIndicator').className = 'status offline';
            document.getElementById('statusText').textContent = 'Aguardando...';
            addLog('C√≥digo limpo', 'info');
        }

        // Inicializa√ß√£o
        addLog('üçï Pizzaria Bot pronto! Clique em "Gerar C√≥digo" para come√ßar.', 'info');
    </script>
</body>
</html>
